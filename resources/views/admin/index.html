<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Input Multi Editor Otomatis</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        />

        <style>
            /* Styling untuk editor konten */
            .rich-editor {
                border: 1px solid #ced4da;
                padding: 0.75rem;
                min-height: 100px;
                overflow-y: auto;
                border-radius: 0.25rem;
                transition: border-color 0.15s ease-in-out,
                    box-shadow 0.15s ease-in-out;
                margin-top: 5px;
            }
            .rich-editor:focus {
                border-color: #86b7fe;
                outline: 0;
                box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            }
            .hidden {
                display: none !important;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <h3 class="mb-4">Area Input Soal Otomatis (5 Input)</h3>

                    <div>
                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >1. Pertanyaan</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-primary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-question"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-question"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pertanyaan"
                                data-placeholder="Tulis Pertanyaan di sini..."
                            ></div>
                        </div>
                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >1. Pertanyaan</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-primary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-question"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-question"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pertanyaan"
                                data-placeholder="Tulis Pertanyaan di sini..."
                            ></div>
                        </div>

                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >2. Pilihan A</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-secondary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-option-a"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-option-a"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pilihan_a"
                                data-placeholder="Tulis Pilihan A di sini..."
                            ></div>
                        </div>

                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >3. Pilihan B</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-secondary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-option-b"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-option-b"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pilihan_b"
                                data-placeholder="Tulis Pilihan B di sini..."
                            ></div>
                        </div>

                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >4. Pilihan C</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-secondary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-option-c"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-option-c"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pilihan_c"
                                data-placeholder="Tulis Pilihan C di sini..."
                            ></div>
                        </div>

                        <div class="mb-4 p-3 border rounded">
                            <label
                                class="form-label text-uppercase text-muted fw-bold small"
                                >5. Pilihan D</label
                            >
                            <div class="d-flex justify-content-end mb-2">
                                <label
                                    class="btn btn-outline-secondary btn-sm cursor-pointer"
                                >
                                    <i class="fas fa-image me-1"></i> +Gambar
                                    <input
                                        type="file"
                                        class="image-uploader hidden"
                                        data-target="editor-option-d"
                                        accept="image/*"
                                    />
                                </label>
                            </div>
                            <div
                                id="editor-option-d"
                                class="rich-editor content-source"
                                contenteditable="true"
                                data-label="pilihan_d"
                                data-placeholder="Tulis Pilihan D di sini..."
                            ></div>
                        </div>

                        <button
                            id="checkContentBtn"
                            class="btn btn-success w-100"
                        >
                            Cek Konten Otomatis (5 Input)
                        </button>
                    </div>

                    <div
                        id="output"
                        class="mt-4 p-3 bg-light border rounded"
                        style="display: none"
                    >
                        <strong>Konten Terkini yang diambil otomatis:</strong>
                        <pre id="outputContent" class="mb-0"></pre>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const imageUploaders =
                    document.querySelectorAll(".image-uploader");
                const checkContentBtn =
                    document.getElementById("checkContentBtn");
                const outputDiv = document.getElementById("output");
                const outputContent = document.getElementById("outputContent");

                // Ambil SEMUA elemen editor yang ingin diambil datanya
                const contentSources =
                    document.querySelectorAll(".content-source");

                // Fungsi Pembantu: Menyisipkan node ke posisi kursor pada editor tertentu
                function insertNodeAtCursor(editorElement, node) {
                    editorElement.focus();
                    const selection = window.getSelection();

                    if (selection.getRangeAt && selection.rangeCount) {
                        let range = selection.getRangeAt(0);
                        if (
                            !editorElement.contains(
                                range.commonAncestorContainer
                            )
                        ) {
                            range = document.createRange();
                            range.selectNodeContents(editorElement);
                            range.collapse(false);
                        }

                        range.deleteContents();
                        range.insertNode(node);

                        range.setStartAfter(node);
                        range.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(range);
                    } else {
                        editorElement.appendChild(node);
                    }
                }

                // Listener untuk setiap input file (TIDAK BERUBAH, sudah otomatis)
                imageUploaders.forEach((uploader) => {
                    uploader.addEventListener("change", function (event) {
                        const file = event.target.files[0];
                        const targetId =
                            event.target.getAttribute("data-target");
                        const targetEditor = document.getElementById(targetId);

                        if (file && targetEditor) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const img = document.createElement("img");
                                img.src = e.target.result; // Gambar dalam Base64
                                img.style.maxWidth = "100%";
                                img.style.height = "auto";
                                img.style.display = "block";
                                img.style.margin = "10px 0";

                                insertNodeAtCursor(targetEditor, img);
                            };
                            reader.readAsDataURL(file);
                        }
                        event.target.value = ""; // Reset input file
                    });
                });

                // LISTENER OTOMATIS: Tombol "Cek Konten"
                checkContentBtn.addEventListener("click", function () {
                    const currentData = {};

                    // Loop melalui SEMUA elemen editor dengan kelas 'content-source'
                    contentSources.forEach((editor) => {
                        // Ambil kunci/key dari data-label (misal: 'pertanyaan', 'pilihan_a')
                        const key = editor.getAttribute("data-label");

                        // Masukkan konten HTML ke objek data dengan kunci yang sesuai
                        currentData[key] = editor.innerHTML;
                    });

                    outputContent.textContent = JSON.stringify(
                        currentData,
                        null,
                        2
                    );
                    outputDiv.style.display = "block";
                });
            });
        </script>
    </body>
</html>
